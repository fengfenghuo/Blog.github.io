# IPFS: Filecoin和复制证明
[TOC]

原文链接 <https://zhuanlan.zhihu.com/p/32809642>

这篇文章主要来讲一下Filecoin协议里面的复制证明（Proof of Replication），由于协议涉及到很多概念，可能看起来有点晕乎乎的，小编尽量把复杂问题简单化 ，力求给大家做大普及IPFS知识


## 概念：

- **挑战（challenge）**：系统对矿工发起提问，可能是一个问题或者一系列问题，矿工正确的答复，则挑战成功，否则失败
- **证明者（prover）**：矿工向Filecoin系统提供有效的证明，来完成挑战（challenge）
- **检验者（verifier）**：系统代表用户向矿工发起挑战（challenge），来检测是否矿工完成了数据存储任务
- **数据（data）**：用户向矿工提交的需要存储或者矿工已经存储的数据
- **证明（proof）**：矿工完成挑战（challenge）时候的回答
- **流程**：系统（verifier）向矿工（prover）发起挑（challenge），矿工答复证明（proof），系统检验矿工的答复以判断矿工是否通过本次挑战（challenge）。

## Filecoin涉及到的证明概念：

- **数据持有性证明（Provable Data Possession ，PDP)**：用户发送数据给矿工进行存储，矿工证明数据已经被自己存储，用户可以重复检查矿工是否还在存储自己的数据
- **可检索证明（Proof-of-Retrievability，PoRet）**：和PDP过程比较类似，证明矿工存储的数据是可以用来查询的。 
- **存储证明（Proof-of-Storage ，PoS）**：利用存储空间进行的证明。工作量证明的一种，Filecoin上一篇论文使用了这个名字，新的论文则升级为PoRep
- **复制证明（Proof-of-Replication，PoRep）**：新的 PoS（Proof-of-Storage），PoRep可以保证每份数据的存储都是独立的，可以防止女巫攻击，外源攻击和生成攻击
- **工作量证明（Proof-of-Work，PoW）**：证明者向检验者证明自己花费了一定的资源，PoW被用在加密货币，拜占庭共识和其他各种区块链系统。BTC使用的就是这种类型的证明，依赖巨量的哈希计算和能源消耗来建立共识和保证btc网络的安全性
- **空间证明（Proof-of-Space，PoSpace）**：Filecoin提出的概念，存储量的证明，PoSpace是PoW的一种，不同的是PoW使用的计算资源，而PoSpace使用的是存储资源
- **时空证明（Proof-of-Spacetime，PoSt)**：时空证明，矿工证明自己花费了spacetime资源, 即：一定时间内的存储空间的使用，PoSt是基于PoReps实现的
- **复制证明（Proof of Replication，PoRep）**：PoRep 是PoS的进化版：用来证明 数据（data）已经被矿工存储

## 为什么要搞这么复杂？

区块链里面任何精巧的系统都需要精心设计（比如BTC），让系统能够自己一直运行下去，搞这么复杂目的不外乎下面两个：

1. 保证矿工能够老老实实的帮助用户存储数据
2. 公平的分配代币

## 复制证明：Proofs-of-Replication

PoRep必须能够防范以下三种常见的攻击方式：女巫攻击，外源攻击和生成攻击，他们的共同特点是攻击矿工实际存储的数据大小要比声称存储的数据小，这样攻击矿工就能获得本不该他获得的报酬。

- **女巫攻击（Sybil Attack）**：利用n个身份，承诺存储n份数据D，而实际上存储小于n份（比如1份），但是却提供了n份存储证明，攻击成功。
- **外部数据源攻击（Outsourcing Attack）**：当攻击者矿工收到检验者要求提供数据D的证明的时候，攻击者矿工从别的矿工那里生成证明，证明自己一直存储了数据D，而实际上没有存储，攻击成功
- **生成攻击（Generation Attack）**：攻击者A可以使用某种方式生成数据D，当检验者验证的时候，攻击者A就可以重新生成数据D来完成存储证明，攻击成功

防范生成攻击比较困难，所有的PoS协议都会遇到这样的问题，如何保证矿工真正的存储了这些数据，目前这还是个待解决的问题，PoRep需要解决这个问题，Filecoin协议采用一种叫做 RepGame 的游戏来一起解决这三种攻击方式，PoRes还在此基础上引入了时限性（Time Bounded），PoRes协议的实现可能有很多种方式，不管哪种实现方式都必须能够防止上面的三中攻击方式，并且要能够通过RepGame游戏的测试。

## 时空证明：Proofs-of-Spacetime

时空证明提出了证明链（proof-chain）的数据结构，证明链把一些的提问（challenge）和证明（proof）链接起来形成。在证明链的基础上添加上时间段，这样就得到了一段时间内的矿工存储数据的证明，这就是时空证明（Proof of Spacetime，PoSt），PoSt可以证明在该段时间内矿工存储了特定的数据，并且利用时间戳锚定这些证明链，这样即使验证者（verifier）不在线，也能够在将来去验证矿工在该段时间内生成了证明链，**PoSt会被提交到链上**用来产生新的Block。


